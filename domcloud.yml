features:
  - go

nginx:
  root: public_html/public
  locations:
    - match: /static
      alias: static
      expires: 1d
    - match: /swagger
      try_files: $uri @app
    - match: /api
      try_files: $uri @app
    - match: /
      try_files: $uri @app
  
passenger:
  enabled: "on"
  app_start_command: ./startup.sh
  app_type: generic
  
commands:
  - echo "ðŸš€ Starting MultipleScrape API deployment..."
  - go version
  - echo "ðŸ“¦ Downloading dependencies..."
  - go mod download
  - go mod verify
  - echo "ðŸ”¨ Building optimized binary..."
  - CGO_ENABLED=0 GOOS=linux go build -ldflags="-s -w -X main.version=$(date +%Y%m%d-%H%M%S)" -o app
  - chmod +x app
  - chmod +x startup.sh
  - echo "âœ… Build completed successfully!"
  - ls -la app startup.sh
  - echo "ðŸ“Š Binary size:" && du -h app
  - echo "ðŸ§ª Testing binary..."
  - ./app --version || echo "Binary ready for deployment"